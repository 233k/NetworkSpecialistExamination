# SAN

SAN (Storage Area Network)：複数のサーバ間でネットワークを介したディスク装置共有を可能にする技術。SCSI接続と機能的に同等であり、 `SCSI` コマンドを使用し、ブロック単位でアクセスする。

<-> NAS (Network Attached Storage)：ファイルサーバと機能的に同等。ファイル単位でアクセスする。

SAN は、FC-SAN と IP-SAN がに大別される。

## FC-SAN

```
+------+              +---------+
| Host |              | Storage |
|  +---+   +------+   +--+ +--+ |
|  |HBA|---| FCSW |---|SC| |LU| |
|  +---+   +------+   +--+ +--+ |
+------+              +---------+
```

- ホストバスアダプタ：ホストのインターフェース
- ファイバチャネルスイッチ：ホストとSANのストレージを接続
- ストレージコントローラ：ストレージのインターフェース
- ロジカルユニット：RAIDコントローラにより物理ディスクを束ねた上で、区分された外部に提供する論理的なディスク

### ファイバチャネル

接続形態

- ポイントツーポイント型：ホストとストレージが１対１
- ファブリック型：FSCWを挟んでホストとストレージが多対多（一般的）
- 調停ループ型：ホスト又はストレージが複数接続される

### ゾーニング

- ゾーン：FCSWに接続するサーバやストレージに対して指定するグループ
- ゾーニング：複数のゾーンを定義する

### FCの冗長構成

スイッチ間の経路を複数持たせた冗長構成を取らせることができる。

FSPF (Fabric Shortest Path First)：FCSWのホップ数として最小経路を求めるアルゴリズム

### FC のプロトコルスタック

FC では 0 ~ 4層のプロトコルスタックを持つ。SCSIは、FCの上位プロトコルにあたり、SCSIをカプセル化するFC4層のプロトコルは、**FCP**である。

### FC-SANのフロー制御

FC-SANは、Buffer-to-Bufferでフロー制御が行われる。

<-> TCP/IP は、End-to-End なため経路途中で輻輳が起こりうる。

### 統合ネットワーク

統合ネットワークでは、FCフレームを FCoE (Fibre Channel over Ethernet) フレームでカプセル化し、拡張イーサネットフレームでカプセル化する。

拡張イーサネットを使用する場合、FC-0層 ~ FC-1層が拡張イーサネットで置き換わる。

### 拡張イーサネット

拡張イーサネット = DCB (Data Center Bridging)

CNA (Converged Network Adapter)：拡張イーサネットにおけるネットワーク接続アダプタ。HBAとNICを兼ね備える機能を持つ

## IP-SAN

IP-SAN の通信規格。いずれもTCP/IP上で動作し、SCSIをカプセル化している。

- iSCSI：IP / TCP / iSCSI /SCSI
- iFCP：IP / TCP / IFCP / FCP / SCSI
- FCIP：IP / TCP / FCIP / FCP / SCSI

### iSCSI

- **イニシエータ**：サーバ側で動作し、SCSIコマンドを発行するソフトウェア
- **ターゲット**：ストレージ装置で動作し、SCSIコマンドの処理を実行するソフトウェア

iSCSIのプロトコルをハードウェアで実行する iSCSI HBAをサーバに搭載することもできる。
