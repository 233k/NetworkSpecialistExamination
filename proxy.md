# プロキシ

- フォワードプロキシ
- リバースプロキシ

## フォワードプロキシ

### DNS による名前解決はプロキシが行う
したがって、プロキシ使用環境下ではクライアント側ではなく、プロキシのDNS設定を変更する

### GET メソッドのURI

- 通常のHTTP GET
```
GET /news/index.html HTTP/1.1
```
- プロキシ接続の場合
```
GET http://www.example.com/news/index.html HTTP/1.1
```

### HTTPS 通信
CONNECTメソッドを利用するとHTTP以外のプロトコル（HTTPS以外も可能）をトンネルするよう指示できる。以下がその流れ


CONNECTメソッドで宛先URIをプロキシに通知
```
CONNECT www.example.com:443 HTTP/1.1
```

これを受けたプロキシは宛先URIとのコネクションを作成後、プロキシはクライアントに http メッセージを返送

```
HTTP/1.1 200 Connection Established
```

この後プロキシは、TLS や https 通信の中身には触れず、IP ヘッダと TCP ヘッダを変更して Web サーバへ転送

#### プロキシによるhttps通信の傍受方法

1. プロキシに https 通信したいサーバの秘密鍵を持たせる（インターネット上のサーバで秘密鍵をもらうことは、現実的に不可能）

2. プロキシに動的にサーバ証明書を生成・保持し、https 通信が来た場合はそのサーバ証明書をクライアントに提示する（ただし、生成するサーバ証明書のルート証明書を、あらかじめ全ての PC にインストールする必要がある）

## プロキシ自動設定
ブラウザ上で行うプロキシ設定では、以下が登録できる
- プロキシのIPアドレスとポートの組
- 上記プロキシを経由するホスト名、ポート番号
- 上記プロキシを経由しないホスト名、ポート番号

プロキシ自動設定（PAC：Proxy Auto-Configuration）により自動化される